Index: php5-5.4.45/ext/exif/exif.c
===================================================================
--- php5-5.4.45.orig/src/ext/exif/exif.c	2016-12-09 15:44:19.153939754 +0100
+++ php5-5.4.45/src/ext/exif/exif.c	2016-12-09 15:44:19.149939865 +0100
@@ -3768,8 +3768,11 @@
 						fgot = php_stream_read(ImageInfo->infile, ImageInfo->Thumbnail.data, ImageInfo->Thumbnail.size);
 						if (fgot < ImageInfo->Thumbnail.size) {
 							EXIF_ERRLOG_THUMBEOF(ImageInfo)
+							efree(ImageInfo->Thumbnail.data);
+							ImageInfo->Thumbnail.data = NULL;
+						} else {
+							exif_thumbnail_build(ImageInfo TSRMLS_CC);
 						}
-						exif_thumbnail_build(ImageInfo TSRMLS_CC);
 					}
 #ifdef EXIF_DEBUG
 					exif_error_docref(NULL EXIFERR_CC, ImageInfo, E_NOTICE, "Read next IFD (THUMBNAIL) done");
