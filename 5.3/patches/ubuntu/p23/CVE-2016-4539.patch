Backport of:

From dccda88f27a084bcbbb30198ace12b4e7ae961cc Mon Sep 17 00:00:00 2001
From: Stanislav Malyshev <stas@php.net>
Date: Sun, 24 Apr 2016 23:50:57 -0700
Subject: [PATCH] Fix bug #72099: xml_parse_into_struct segmentation fault

---
 ext/xml/tests/bug72099.phpt |  17 +++++++
 ext/xml/xml.c               | 106 ++++++++++++++++++++++----------------------
 2 files changed, 70 insertions(+), 53 deletions(-)
 create mode 100644 ext/xml/tests/bug72099.phpt

Index: php5-5.3.10/ext/xml/tests/bug72099.phpt
===================================================================
--- /dev/null	1970-01-01 00:00:00.000000000 +0000
+++ php5-5.3.10/src/ext/xml/tests/bug72099.phpt	2016-05-19 12:48:54.775040151 -0400
@@ -0,0 +1,17 @@
+--TEST--
+Bug #72099: xml_parse_into_struct segmentation fault
+--SKIPIF--
+<?php
+require_once("skipif.inc");
+?>
+--FILE--
+<?php
+$var1=xml_parser_create_ns();
+$var2=str_repeat("a", 10);
+$var3=array();
+$var4=array();
+xml_parse_into_struct($var1, $var2, $var3, $var4);
+var_dump($var3);
+--EXPECT--
+array(0) {
+}
\ No newline at end of file
Index: php5-5.3.10/ext/xml/xml.c
===================================================================
--- php5-5.3.10.orig/src/ext/xml/xml.c	2016-05-19 12:48:54.775040151 -0400
+++ php5-5.3.10/src/ext/xml/xml.c	2016-05-19 12:48:54.775040151 -0400
@@ -1084,7 +1084,7 @@
 						}
 					}
 
-					if (parser->level <= XML_MAXLEVEL) {
+					if (parser->level <= XML_MAXLEVEL && parser->level > 0) {
 						MAKE_STD_ZVAL(tag);
 
 						array_init(tag);
