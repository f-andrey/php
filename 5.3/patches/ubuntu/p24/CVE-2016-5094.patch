Backport of:

From 0da8b8b801f9276359262f1ef8274c7812d3dfda Mon Sep 17 00:00:00 2001
From: Stanislav Malyshev <stas@php.net>
Date: Sun, 15 May 2016 23:26:51 -0700
Subject: [PATCH] Fix bug #72135 - don't create strings with lengths outside
 int range

---
 ext/standard/html.c | 50 +++++++++++++++++++++++++++-----------------------
 1 file changed, 27 insertions(+), 23 deletions(-)

Index: php53-5.3.29/src/ext/standard/html.c
===================================================================
--- php53-5.3.29.orig/src/ext/standard/html.c	2016-10-06 17:23:05.855632488 +0300
+++ php53-5.3.29/src/ext/standard/html.c	2016-10-06 17:23:05.850632643 +0300
@@ -1288,6 +1288,10 @@
 	}
 
 	replaced = php_escape_html_entities_ex(str, str_len, &len, all, quote_style, hint_charset, double_encode TSRMLS_CC);
+	if (len > INT_MAX) {
+		efree(replaced);
+		RETURN_FALSE;
+	}
 	RETVAL_STRINGL(replaced, len, 0);
 }
 /* }}} */
