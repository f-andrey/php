Description: fix more missing file path null byte checks
Origin: backport, http://git.php.net/?p=php-src.git;a=commit;h=be9b2a95adb504abd5acdc092d770444ad6f6854
Bug: https://bugs.php.net/bug.php?id=69418

Index: php5-5.3.10/ext/pcntl/pcntl.c
===================================================================
--- php5-5.3.10.orig/src/ext/pcntl/pcntl.c	2015-06-30 13:45:39.840977383 -0400
+++ php5-5.3.10/src/ext/pcntl/pcntl.c	2015-06-30 13:45:39.836977338 -0400
@@ -758,6 +758,11 @@
 	if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, "s|aa", &path, &path_len, &args, &envs) == FAILURE) {
 		return;
 	}
+
+	/* No nulls allowed in paths */
+	if (strlen(path) != path_len) {
+		RETURN_FALSE;
+	}
 	
 	if (ZEND_NUM_ARGS() > 1) {
 		/* Build argument list */
Index: php5-5.3.10/ext/standard/dir.c
===================================================================
--- php5-5.3.10.orig/src/ext/standard/dir.c	2015-06-30 13:45:39.840977383 -0400
+++ php5-5.3.10/src/ext/standard/dir.c	2015-06-30 13:46:01.477222183 -0400
@@ -219,6 +219,11 @@
 		RETURN_NULL();
 	}
 
+	/* No nulls allowed in paths */
+	if (strlen(dirname) != dir_len) {
+		RETURN_FALSE;
+	}
+
 	context = php_stream_context_from_zval(zcontext, 0);
 	
 	dirp = php_stream_opendir(dirname, ENFORCE_SAFE_MODE|REPORT_ERRORS, context);
@@ -293,7 +298,12 @@
 	if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, "s", &str, &str_len) == FAILURE) {
 		RETURN_FALSE;
 	}
-	
+
+	/* No nulls allowed in paths */
+	if (strlen(str) != str_len) {
+		RETURN_FALSE;
+	}
+
 	ret = chroot(str);
 	if (ret != 0) {
 		php_error_docref(NULL TSRMLS_CC, E_WARNING, "%s (errno %d)", strerror(errno), errno);
