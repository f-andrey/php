diff -up php-5.2.17/sapi/cgi/cgi_main.c.CVE-2012-2311 php-5.2.17/sapi/cgi/cgi_main.c
--- php-5.2.17/src/sapi/cgi/cgi_main.c.CVE-2012-2311	2012-07-22 23:37:03.000000000 -0400
+++ php-5.2.17/src/sapi/cgi/cgi_main.c	2012-07-22 23:39:43.000000000 -0400
@@ -1421,7 +1421,7 @@ int main(int argc, char *argv[])
 		free(decoded_query_string);
 	}
 
-	while (!skip_getopt && (c = php_getopt(argc, argv, OPTIONS, &php_optarg, &php_optind, 0)) != -1) {
+	if (!cgi) while (!skip_getopt && (c = php_getopt(argc, argv, OPTIONS, &php_optarg, &php_optind, 0)) != -1) {
 		switch (c) {
 			case 'c':
 				if (cgi_sapi_module.php_ini_path_override) {
@@ -1675,7 +1675,7 @@ consult the installation file that came 
 #endif /* FASTCGI */
 
 	zend_first_try {
-		while ((c = php_getopt(argc, argv, OPTIONS, &php_optarg, &php_optind, 1)) != -1) {
+		if (!cgi) while ((c = php_getopt(argc, argv, OPTIONS, &php_optarg, &php_optind, 1)) != -1) {
 			switch (c) {
 #if PHP_FASTCGI
 				case 'T':
